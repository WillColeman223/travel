<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Petersfield Station LED Board</title>
<style>
body {
  margin:0; padding:0;
  background-color:#000;
  font-family:'Courier New', monospace;
  color:#00FF00;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.board {
  width:95%;
  max-width:1200px;
  border:5px solid #00FF00;
  box-shadow:0 0 20px rgba(0,255,0,0.5);
  padding:10px;
  background-color:#000;
  overflow:hidden;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  padding:8px 12px;
  border-bottom:1px solid #00FF00;
  white-space:nowrap;
}

th { font-size:1.2rem; }
td { font-size:1.1rem; }

.status { font-weight:bold; }
.on-time { color:#00FF00; }
.delayed { color:#FF0000; }
.cancelled { color:#FF9900; }

/* Scrolling effect for long text */
.scroll-cell {
  display:inline-block;
  position:relative;
  max-width:200px;
  overflow:hidden;
  vertical-align:middle;
}

.scroll-cell span {
  display:inline-block;
  padding-left:100%;
  animation: scroll-text 8s linear infinite;
}

@keyframes scroll-text {
  0% { transform: translateX(0%); }
  100% { transform: translateX(-100%); }
}
</style>
</head>
<body>

<div class="board">
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Destination</th>
        <th>Platform</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="departure-board">
      <tr><td colspan="4">Loading departures...</td></tr>
    </tbody>
  </table>
</div>

<script>
const url = 'http://localhost:3000/departures';

async function fetchDepartures() {
  try {
    const response = await fetch(url);
    const data = await response.json();

    console.log("Raw RTT JSON:", data); // Debug: check structure

    // For free account, departures are directly under data.departures
    const departuresArray = Array.isArray(data.departures) ? data.departures : [];

    const board = document.getElementById('departure-board');
    board.innerHTML = '';

    if (departuresArray.length === 0) {
      board.innerHTML = '<tr><td colspan="4">No departures available at the moment.</td></tr>';
      return;
    }

    departuresArray.forEach(dep => {
      const statusText = dep.etd || dep.status || 'On time';
      const statusClass = getStatusClass(statusText);

      const row = document.createElement('tr');

      row.innerHTML = `
        <td>${dep.std || ''}</td>
        <td class="scroll-cell"><span>${dep.destination_name || dep.destination || ''}</span></td>
        <td>${dep.platform || 'TBC'}</td>
        <td class="status ${statusClass}">${statusText}</td>
      `;

      board.appendChild(row);
    });

  } catch (error) {
    console.error('Error fetching departures:', error);
    document.getElementById('departure-board').innerHTML =
      '<tr><td colspan="4">Error fetching departures.</td></tr>';
  }
}

function getStatusClass(status) {
  if (!status) return 'on-time';
  const s = status.toLowerCase();
  if (s.includes('delayed')) return 'delayed';
  if (s.includes('cancelled')) return 'cancelled';
  return 'on-time';
}

// Initial fetch
fetchDepartures();

// Refresh every 30 seconds
setInterval(fetchDepartures, 30000);
</script>

</body>
</html>


